@using Brewlogger_Blz.Models;
@using System.ComponentModel.DataAnnotations;
@inject HttpClient Http;
@inject NavigationManager NavigationManager;

<article class="rounded-md bg-blue-50 p-4">
    <div class="flex justify-center w-full ml-1/2">
        <figure class="flex-shrink-0">
            <svg class="h-5 w-5 text-blue-400" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z" clip-rule="evenodd"/>
            </svg>
        </figure>
        <p class="text-sm text-blue-700">Form Status: @_status</p>
    </div>
</article>

<EditForm Model="@_brewlog" FormName="Brewlog Form" OnValidSubmit="HandleValidSubmit" class="flex flex-col w-1/2 mx-auto mt-20 gap-3">
    <DataAnnotationsValidator/>
    <img class="mx-auto w-52 h-52 rounded-full object-cover" src="@CurrentBrewer.ImageUrl" alt="Image of @CurrentBrewer.Name">
    <h4 id="brewerName" class="mx-auto text-2xl">@CurrentBrewer.Name</h4>

    <label for="coffeeName">Coffee Name:</label>
    <ValidationMessage For="@(() => _brewlog!.CoffeeName)"/>
    <InputText id="coffeeName" placeholder="Guatemala Light Roast" @bind-Value="_brewlog.CoffeeName" class="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"/>
    <label for="dose" class="block text-sm font-medium leading-6 text-gray-900">Dose (grams):</label>
    <ValidationMessage For="@(() => _brewlog!.Dose)"/>
    <InputNumber id="dose" placeholder="@CurrentBrewer.StartingDose" @bind-Value="_brewlog.Dose" class="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"/>
    <label for="grind" class="block text-sm font-medium leading-6 text-gray-900">Grind:</label>
    <InputText id="grind" placeholder="Pre-ground - Medium" @bind-Value="_brewlog.Grind" class="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"/>
    <label for="roast" class="block text-sm font-medium leading-6 text-gray-900">Roast:</label>
    <InputText id="roast" placeholder="Light Roast" @bind-Value="_brewlog.Roast" class="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"/>
    <label for="ratio" class="block text-sm font-medium leading-6 text-gray-900">Brew Ratio:</label>
    <InputSelect id="ratio" @bind-Value="_brewlog.BrewRatio" class="mt-2 block w-full rounded-md border-0 py-1.5 pl-3 pr-10 text-gray-900 ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-indigo-600 sm:text-sm sm:leading-6">
        <option>Select Brew Ratio</option>
        @for (int i = 7; i < 21; i++)
        {
            <option value="@i">1:@i</option>
        }
    </InputSelect>
    <label for="rating" class="block text-sm font-medium leading-6 text-gray-900">Rating:</label>
    <InputSelect id="rating" @bind-Value="_brewlog.Rating" class="mt-2 block w-full rounded-md border-0 py-1.5 pl-3 pr-10 text-gray-900 ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-indigo-600 sm:text-sm sm:leading-6">
        @for (int i = 0; i < 6; i++)
        {
            <option value="@i">@i</option>
        }
    </InputSelect>
    <label for="notes" class="block text-sm font-medium leading-6 text-gray-900">Notes</label>
    <InputTextArea id="notes" rows="2" placeholder="Using Brewlogger Recipe" @bind-Value="_brewlog.Notes" class="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6" />

    <button type="submit" class="rounded-md bg-indigo-500 px-3 py-2 mx-auto w-20 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600">Submit</button>
</EditForm>

@code {
    [Parameter] public Brewer? CurrentBrewer { get; set; }

    private Brewlog _brewlog = new();

    private string _status = "Not submitted";

    protected override void OnParametersSet()
    {
        if (CurrentBrewer != null)
        {
            _brewlog.BrewerUsed = CurrentBrewer.Name;
            // Set any default values for the form if needed
        }
    }

    private async Task HandleValidSubmit()
    {
        _status = "Submitted";
        // POST form somewhere 
        NavigationManager.NavigateTo("/");
    }

}